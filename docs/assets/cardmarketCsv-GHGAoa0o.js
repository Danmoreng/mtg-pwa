(function(){"use strict";function y(d){const l=d.split(`
`),c=l[0].split(";").map(u=>u.trim()),o=[];for(let u=1;u<l.length;u++){const i=l[u].trim();if(!i)continue;const m=i.split(";"),s={},e={};for(let t=0;t<c.length;t++){const r=c[t],a=m[t]?m[t].trim():"";e[r]=a}const n=(...t)=>{for(const r of t){if(e[r]!==void 0&&e[r]!=="")return e[r];const a=r.toLowerCase();for(const[f,p]of Object.entries(e))if(f.toLowerCase()===a&&p!=="")return p}return""};s.reference=n("Reference","Referenz","Transaktions-ID"),s.date=n("Date","Datum","Date Paid","Date paid","Datum Paid"),s.category=n("Category","Kategorie"),s.type=n("Type","Typ"),s.counterpart=n("Counterpart","Gegenpartei"),s.amount=n("Amount","Betrag"),s.balanceAfter=n("Closing balance (EUR)","Balance After","Saldo danach (EUR)"),s.reference&&(s.lineNumber=u,s.currency="EUR",o.push(s))}return o}function g(d,l){const c=d.split(`
`),o=c[0].split(";").map(i=>i.trim()),u=[];for(let i=1;i<c.length;i++){const m=c[i].trim();if(!m)continue;const s=m.split(";"),e={},n={};for(let r=0;r<o.length;r++){const a=o[r],f=s[r]?s[r].trim():"";n[a]=f}const t=(...r)=>{for(const a of r){if(n[a]!==void 0&&n[a]!=="")return n[a];const f=a.toLowerCase();for(const[p,h]of Object.entries(n))if(p.toLowerCase()===f&&h!=="")return h}return""};e.orderId=t("Order ID","OrderID","Bestellnummer"),e.dateOfPurchase=t("Date of Purchase","Date","Date of payment","Kaufdatum","Zahlungsdatum"),e.username=t("Username","Benutzername"),e.country=t("Country","Land"),e.city=t("City","Stadt"),e.articleCount=t("Article Count","Items","Anzahl Artikel"),e.merchandiseValue=t("Merchandise Value","Warenwert"),e.shipmentCosts=t("Shipment Costs","Versandkosten"),e.commission=t("Commission","Trustee service fee","Provision"),e.totalValue=t("Total Value","Gesamtwert"),e.orderId&&(e.lineNumber=i,e.direction=l,e.currency="EUR",u.push(e))}return u}function C(d,l){const c=d.split(`
`),o=c[0].split(";").map(i=>i.trim()),u=[];for(let i=1;i<c.length;i++){const m=c[i].trim();if(!m)continue;const s=m.split(";"),e={},n={};for(let r=0;r<o.length;r++){const a=o[r],f=s[r]?s[r].trim():"";n[a]=f}const t=(...r)=>{for(const a of r){if(n[a]!==void 0&&n[a]!=="")return n[a];const f=a.toLowerCase();for(const[p,h]of Object.entries(n))if(p.toLowerCase()===f&&h!=="")return h}return""};e.shipmentId=t("Shipment nr.","Shipment nr","Shipment ID","Order ID","Bestellnummer"),e.dateOfPurchase=t("Date of purchase","Date"),e.productId=t("Product ID","Produkt ID"),e.name=t("Article","Artikel","Localized Product Name","Produktname"),e.expansion=t("Expansion","Erweiterung"),e.category=t("Category","Kategorie"),e.amount=t("Amount","Anzahl"),e.price=t("Article Value","Price","Preis"),e.total=t("Total"),e.currency=t("Currency"),e.comments=t("Comments"),e.shipmentId&&(e.lineNumber=i,e.direction=l,e.currency||(e.currency="EUR"),u.push(e))}return u}self.onmessage=function(d){const{type:l,data:c}=d.data;try{let o;switch(l){case"parseTransactions":o=y(c);break;case"parseOrders":o=g(c,d.data.direction);break;case"parseArticles":o=C(c,d.data.direction);break;default:throw new Error(`Unknown parse type: ${l}`)}self.postMessage({type:l,result:o})}catch(o){self.postMessage({type:l,error:o instanceof Error?o.message:String(o)})}}})();
