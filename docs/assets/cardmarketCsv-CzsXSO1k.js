(function(){"use strict";function m(n){if(n==null)return 0;if(typeof n=="number")return n;if(typeof n!="string"&&(n=String(n)),!n.trim())return 0;const l=n.replace(",",".").replace(/[^0-9.-]+/g,""),s=parseFloat(l);return Number.isFinite(s)?s:0}function g(n){const l=n.split(`
`),s=l[0].split(";").map(f=>f.trim()),a=[];for(let f=1;f<l.length;f++){const u=l[f].trim();if(!u)continue;const p=u.split(";"),i={},e={};for(let t=0;t<s.length;t++){const r=s[t],c=p[t]?p[t].trim():"";e[r]=c}const o=(...t)=>{for(const r of t){if(e[r]!==void 0&&e[r]!=="")return e[r];const c=r.toLowerCase();for(const[d,h]of Object.entries(e))if(d.toLowerCase()===c&&h!=="")return h}return""};i.reference=o("Reference","Referenz","Transaktions-ID"),i.date=o("Date","Datum","Date Paid","Date paid","Datum Paid"),i.category=o("Category","Kategorie"),i.type=o("Type","Typ"),i.counterpart=o("Counterpart","Gegenpartei"),i.amount=m(o("Amount","Betrag")),i.balanceAfter=m(o("Closing balance (EUR)","Balance After","Saldo danach (EUR)")),i.reference&&(i.lineNumber=f,i.currency="EUR",a.push(i))}return a}function C(n,l){const s=n.split(`
`),a=s[0].split(";").map(u=>u.trim()),f=[];for(let u=1;u<s.length;u++){const p=s[u].trim();if(!p)continue;const i=p.split(";"),e={},o={};for(let r=0;r<a.length;r++){const c=a[r],d=i[r]?i[r].trim():"";o[c]=d}const t=(...r)=>{for(const c of r){if(o[c]!==void 0&&o[c]!=="")return o[c];const d=c.toLowerCase();for(const[h,y]of Object.entries(o))if(h.toLowerCase()===d&&y!=="")return y}return""};e.orderId=t("Order ID","OrderID","Bestellnummer"),e.dateOfPurchase=t("Date of Purchase","Date","Date of payment","Kaufdatum","Zahlungsdatum"),e.username=t("Username","Benutzername"),e.country=t("Country","Land"),e.city=t("City","Stadt"),e.articleCount=t("Article Count","Items","Anzahl Artikel"),e.merchandiseValue=m(t("Merchandise Value","Warenwert")),e.shipmentCosts=m(t("Shipment Costs","Versandkosten")),e.commission=m(t("Commission","Trustee service fee","Provision")),e.totalValue=m(t("Total Value","Gesamtwert")),e.orderId&&(e.lineNumber=u,e.direction=l,e.currency="EUR",f.push(e))}return f}function w(n,l){const s=n.split(`
`),a=s[0].split(";").map(u=>u.trim()),f=[];for(let u=1;u<s.length;u++){const p=s[u].trim();if(!p)continue;const i=p.split(";"),e={},o={};for(let r=0;r<a.length;r++){const c=a[r],d=i[r]?i[r].trim():"";o[c]=d}const t=(...r)=>{for(const c of r){if(o[c]!==void 0&&o[c]!=="")return o[c];const d=c.toLowerCase();for(const[h,y]of Object.entries(o))if(h.toLowerCase()===d&&y!=="")return y}return""};e.shipmentId=t("Shipment nr.","Shipment nr","Shipment ID","Order ID","Bestellnummer"),e.dateOfPurchase=t("Date of purchase","Date"),e.productId=t("Product ID","Produkt ID"),e.name=t("Article","Artikel","Localized Product Name","Produktname"),e.expansion=t("Expansion","Erweiterung"),e.category=t("Category","Kategorie"),e.amount=t("Amount","Anzahl"),e.price=m(t("Article Value","Price","Preis")),e.total=m(t("Total")),e.currency=t("Currency"),e.comments=t("Comments"),e.shipmentId&&(e.lineNumber=u,e.direction=l,e.currency||(e.currency="EUR"),f.push(e))}return f}self.onmessage=function(n){const{type:l,data:s}=n.data;try{let a;switch(l){case"parseTransactions":a=g(s);break;case"parseOrders":a=C(s,n.data.direction);break;case"parseArticles":a=w(s,n.data.direction);break;default:throw new Error(`Unknown parse type: ${l}`)}self.postMessage({type:l,result:a})}catch(a){self.postMessage({type:l,error:a instanceof Error?a.message:String(a)})}}})();
