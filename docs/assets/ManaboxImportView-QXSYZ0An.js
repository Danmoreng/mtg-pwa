import{d as v,r as C,c as x,o as h,a as p,b as M,n as S,t as B,I,_}from"./index-BzG5FXaR.js";const $={class:"manabox-import"},D={class:"mb-3"},L=v({__name:"ManaboxImportView",setup(V){const l=C(null),b=(n,t)=>{l.value={type:n,message:t},setTimeout(()=>{l.value=null},5e3)},g=n=>{const t=[];let o="",r=!1;for(let s=0;s<n.length;s++){const c=n[s],i=s<n.length-1?n[s+1]:"";c==='"'?r&&i==='"'?(o+='"',s++):r=!r:c===","&&!r?(t.push(o),o=""):o+=c}return t.push(o),t},y=async n=>{const t=n.target,o=t.files?.[0];if(o){try{const s=(await o.text()).split(`
`),c=s[0].split(",").map(u=>u.trim()),i=[];for(let u=1;u<s.length;u++){const f=s[u].trim();if(!f)continue;const d=g(f);if(d.length<c.length)continue;const e={};for(let m=0;m<c.length;m++){const k=c[m].toLowerCase(),a=d[m]?d[m].trim():"";switch(k){case"name":e.name=a;break;case"set code":case"set":case"expansion":e.expansion=a;break;case"collector number":case"number":case"card number":e.number=a;break;case"language":case"sprache":e.language=a||"en";break;case"foil":e.foil=a.toLowerCase()==="foil"||a.toLowerCase()==="true"||a.toLowerCase()==="yes";break;case"quantity":case"qty":case"anzahl":e.quantity=parseInt(a)||1;break;case"manabox id":e.id=a||`manabox-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;break;case"scryfall id":e.scryfallId=a;break;case"condition":e.condition=a;break;case"purchase price":e.purchasePrice=a;break;case"misprint":e.misprint=a.toLowerCase()==="true";break;case"altered":e.altered=a.toLowerCase()==="true";break;case"purchase price currency":e.currency=a||"EUR";break;case"rarity":e.rarity=a;break}}e.name&&e.expansion&&e.number&&i.push({id:e.id||`manabox-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:e.name,expansion:e.expansion,number:e.number,language:e.language||"en",foil:e.foil||!1,quantity:e.quantity||1,scannedAt:new Date,source:"manabox",externalRef:`manabox-${e.id||Date.now()}-${Math.random().toString(36).substr(2,9)}`,scryfallId:e.scryfallId})}if(i.length===0){b("error","No valid rows found in the CSV file");return}const w={price:0,fees:0,shipping:0};await I.importManaboxScansWithBoxCost(i,w,new Date,"manabox",`manabox-import-${Date.now()}`),b("success",`Successfully imported ${i.length} ManaBox scans`)}catch(r){console.error("Error importing ManaBox scans:",r),b("error","Failed to import ManaBox scans: "+r.message)}t.value=""}};return(n,t)=>(h(),x("div",$,[t[1]||(t[1]=p("h2",null,"ManaBox Scans Import",-1)),t[2]||(t[2]=p("p",null,"Import your ManaBox scan data to track your physical collection.",-1)),p("div",D,[t[0]||(t[0]=p("label",{for:"manabox-csv",class:"form-label"}," Upload ManaBox CSV ",-1)),p("input",{id:"manabox-csv",type:"file",accept:".csv",onChange:y,class:"form-control"},null,32)]),l.value?(h(),x("div",{key:0,class:S(["status-message",l.value.type])},B(l.value.message),3)):M("",!0)]))}}),E=_(L,[["__scopeId","data-v-127f8235"]]);export{E as default};
