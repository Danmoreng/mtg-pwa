/* _buttons-liquid-glass-variants.scss — single-class glass buttons (always-visible frosted plate) */

/* If your _glass.scss already defines $noise, this will use it. */
$noise: $noise !default;
@if not variable-exists(noise) {
  $noise: url("data:image/svg+xml;utf8,\
  <svg xmlns='http://www.w3.org/2000/svg' width='60' height='60' viewBox='0 0 60 60'>\
  <filter id='n'><feTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='4' stitchTiles='stitch'/></filter>\
  <rect width='60' height='60' filter='url(#n)' opacity='.025'/></svg>");
}

/* ---------- Theme knobs (LIGHT punchier; DARK subtler) ---------- */
:root,
[data-bs-theme="light"],
[data-theme="light"] {
  --btn-glass-blur: 6px;
  --btn-glass-sat: var(--glass-sat, 120%);

  /* how much theme color is infused into the plate & rim */
  --glass-plate: 42%;
  --glass-plate-hover: 52%;
  --glass-plate-active: 58%;

  --glass-border: 72%;
  --glass-border-hover: 80%;
  --glass-border-active: 84%;
}

[data-bs-theme="dark"],
[data-theme="dark"] {
  --btn-glass-blur: 8px;
  --btn-glass-sat: 100%;

  --glass-plate: 26%;
  --glass-plate-hover: 32%;
  --glass-plate-active: 38%;

  --glass-border: 58%;
  --glass-border-hover: 64%;
  --glass-border-active: 70%;
}

/* ---------- Base glass for all .btn-glass-* (no separate .btn-glass needed) ---------- */
.btn[class*="btn-glass-"] {
  position: relative;
  isolation: isolate;
  overflow: hidden;
  background-clip: padding-box;
  border-radius: var(--bs-btn-border-radius, .5rem);

  /* state-local infusion amounts */
  --_plate: var(--glass-plate);
  --_border: var(--glass-border);

  /* ALWAYS-ON tinted fill so the glass never “disappears” */
  background-color: color-mix(in hsl, var(--glass-color, currentColor) var(--_plate), transparent);

  /* crisp border using the same hue */
  border: 1px solid color-mix(in hsl, var(--glass-color, currentColor) var(--_border), transparent);

  /* elevation */
  box-shadow: var(--elev-1, 0 3px 10px rgba(0,0,0,.12));

  /* glass effect */
  backdrop-filter: blur(var(--btn-glass-blur)) saturate(var(--btn-glass-sat));
  -webkit-backdrop-filter: blur(var(--btn-glass-blur)) saturate(var(--btn-glass-sat));

  transition:
          background-color .18s ease,
          border-color .18s ease,
          box-shadow .18s ease,
          backdrop-filter .18s ease,
          -webkit-backdrop-filter .18s ease;

  /* ensure content is above plates */
  z-index: 0;
}

.btn[class*="btn-glass-"] > * { position: relative; z-index: 1; }

/* Frosted/noise plate (sits over the tinted fill) */
.btn[class*="btn-glass-"]::before {
  content: "";
  position: absolute; inset: 0; border-radius: inherit; pointer-events: none;
  z-index: 0; /* under the content, over the base bg */
  background:
          /* soft top highlight */
          linear-gradient(180deg, rgba(255,255,255,.20), transparent 40%),
            /* subtle vertical shaping */
          linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.06) 120%),
            /* noise to avoid banding */
          $noise;
  opacity: .70;
  box-shadow:
          inset 0 1px 0 rgba(255,255,255,.28),
          inset 0 -1px 0 rgba(0,0,0,.18);
}

/* Rim — no glow, just presence */
.btn[class*="btn-glass-"]::after {
  content: "";
  position: absolute; inset: 0; border-radius: inherit; pointer-events: none;
  z-index: 2; /* over the plate */
  border: 1.5px solid color-mix(in hsl, var(--glass-color, currentColor) calc(var(--_border) + 6%), transparent);
  opacity: .28;
  transition: opacity .18s ease;
}

/* States */
.btn[class*="btn-glass-"]:hover {
  --_plate: var(--glass-plate-hover);
  --_border: var(--glass-border-hover);
  background-color: color-mix(in hsl, var(--glass-color, currentColor) var(--_plate), transparent);
  border-color: color-mix(in hsl, var(--glass-color, currentColor) var(--_border), transparent);
  box-shadow: var(--elev-2, 0 6px 18px rgba(0,0,0,.18));
}
.btn[class*="btn-glass-"]:active,
.btn[class*="btn-glass-"].active,
.show > .btn[class*="btn-glass-"].dropdown-toggle {
  --_plate: var(--glass-plate-active);
  --_border: var(--glass-border-active);
  background-color: color-mix(in hsl, var(--glass-color, currentColor) var(--_plate), transparent);
  border-color: color-mix(in hsl, var(--glass-color, currentColor) var(--_border), transparent);
  box-shadow: var(--elev-1, 0 3px 10px rgba(0,0,0,.12));
}
.btn[class*="btn-glass-"]:hover::after { opacity: .34; }

/* Focus ring (no Bootstrap glow) */
.btn[class*="btn-glass-"]:focus-visible,
.btn-check:focus-visible + .btn[class*="btn-glass-"] {
  outline: 2px solid color-mix(in hsl, var(--bs-btn-color, var(--color-text, #000)) 80%, transparent);
  outline-offset: 2px;
}

/* Keep text readable in LIGHT theme (don’t flip to white) */
:root .btn[class*="btn-glass-"],
[data-bs-theme="light"] .btn[class*="btn-glass-"],
[data-theme="light"] .btn[class*="btn-glass-"] {
  color: var(--bs-btn-color, var(--color-text, #000));
  --bs-btn-hover-color: var(--bs-btn-color, var(--color-text, #000));
  --bs-btn-active-color: var(--bs-btn-color, var(--color-text, #000));
}

/* Icons follow text */
.btn[class*="btn-glass-"] svg,
.btn[class*="btn-glass-"] .bi { fill: currentColor; }

/* Reduced-transparency users: fall back to solid, still tinted */
@media (prefers-reduced-transparency: reduce) {
  .btn[class*="btn-glass-"] {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    /* keep the tinted background-color */
  }
}

/* ---------- Single-class variant generator ---------- */
@mixin make-btn-glass-variant($name, $color) {
  $label: color-contrast($color);
  .btn-glass-#{$name} {
    --glass-color: #{$color};     /* drives tint & rim */
    --bs-btn-color: #{$label};    /* readable text color */
    /* neutralize Bootstrap’s own fill so it won’t fight our plate */
    --bs-btn-bg: transparent;
    --bs-btn-border-color: transparent;
    --bs-btn-hover-bg: transparent;
    --bs-btn-active-bg: transparent;
  }
}

/* Build for all Bootstrap theme colors */
@each $name, $color in $theme-colors {
  @include make-btn-glass-variant($name, $color);
}

/* Add custom brand if needed:
@include make-btn-glass-variant(custombrand, #7a5cff);
*/

/* USAGE:
<button class="btn btn-glass-primary">Primary</button>
<button class="btn btn-glass-success">Success</button>
<button class="btn btn-glass-danger">Delete</button>
*/
