/* ===========================
   Theme switcher icon button
   =========================== */
.btn-icon {
  position: relative; display:flex; align-items:center; justify-content:center;
  width: 48px; height: 48px; padding: 0; border: none; background: transparent;
  color: var(--bs-body-color); cursor: pointer; border-radius: 50%;
  transition: color .2s ease;

  &:hover { color: var(--bs-primary); }

  &::before {
    content:""; position:absolute; inset:0; border-radius:50%;
    background: radial-gradient(circle at center,
            color-mix(in hsl, var(--bs-primary) 30%, transparent) 0%, transparent 50%);
    opacity:0; transform: scale(.5); transition: opacity .3s ease, transform .3s ease;
  }
  &:hover::before { opacity:1; transform: scale(1.2); }
}

/* ===========================
   Modal close (glass contexts)
   =========================== */
.modal-content.glass { overflow: clip; }
.modal-content.glass::after { z-index: 0; }
.modal-content.glass > * { position: relative; z-index: 1; }

.modal .btn-close {
  --btn-close-size: 1.25rem;
  width: var(--btn-close-size); height: var(--btn-close-size);
  margin: -0.25rem -0.25rem -0.25rem auto;
  border-radius: 999px; position: relative; z-index: 1;
  box-shadow: none !important; outline: none; opacity: .7;
  --bs-btn-close-color: var(--color-text);
  --_x: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='currentColor' viewBox='0 0 16 16'%3E%3Cpath d='M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 1 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
  background: transparent var(--bs-btn-close-bg, var(--_x)) no-repeat center/60%;
  color: var(--color-text); transition: opacity .18s ease;
  &:hover { opacity: 1; }
  &:focus, &:focus-visible { box-shadow: none !important; }
  &:focus-visible { @include focus-ring(); }
}

.modal .btn-close::before {
  content:""; position:absolute; inset:-40%; border-radius:50%;
  background: conic-gradient(from 90deg at 50% 50%,
          color-mix(in hsl, var(--bs-primary) 40%, transparent) 0deg,
          color-mix(in hsl, var(--bs-success) 40%, transparent) 180deg,
          color-mix(in hsl, var(--bs-primary) 40%, transparent) 360deg);
  filter: blur(10px); opacity: 0; transform: scale(.5);
  transition: opacity .2s ease, transform .2s ease;
}
[data-theme="dark"] .modal .btn-close::before,
[data-bs-theme="dark"] .modal .btn-close::before {
  background: conic-gradient(from 90deg at 50% 50%,
          color-mix(in hsl, var(--bs-primary) 25%, transparent) 0deg,
          color-mix(in hsl, var(--bs-success) 25%, transparent) 180deg,
          color-mix(in hsl, var(--bs-primary) 25%, transparent) 360deg);
}
.modal .btn-close:hover::before { opacity: 1; transform: scale(1); }

/* ===========================
   Navbar Link Highlight
   =========================== */
.navbar .navbar-nav { position: relative; }
.navbar.fixed-top { position: fixed; }

.navbar .nav-link {
  position: relative;
  background: transparent;
  border: none;
  transition: color 0.2s ease;
}

.nav-underline {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 2px;
  background-color: var(--bs-primary);
  border-radius: 1px;
  width: var(--_w, 0px);
  transform: translateX(var(--_x, 0px));
  transition: transform .3s cubic-bezier(.22,.61,.36,1), width .3s cubic-bezier(.22,.61,.36,1);
}

.navbar .nav-link.active {
  font-weight: 600;
  color: var(--bs-primary);
}

/* ==========================================
   Glass Buttons (Bootstrap color-aware)
   ========================================== */

.btn-glass {
  @include glass-button-base; // from _mixins.scss

  --btn-glass-accent: var(--bs-primary);

  color: var(--bs-body-color);
  text-shadow: 0 1px 1px rgba(0,0,0,0.1);
  transition: all 0.2s ease;

  &:focus-visible {
    @include focus-ring;
  }

  /* Fallback for browsers that don't support backdrop-filter */
  @supports not ((-webkit-backdrop-filter: blur(0)) or (backdrop-filter: blur(0))) {
    background: var(--surface-2);
  }
}

/* Color variants: apply theme colors to the accent variable */
@mixin make-btn-glass-variant($name, $color) {
  .btn-glass-#{$name} {
    --btn-glass-accent: #{$color};

    /* Default state: filled with semi-transparent color */
    @include glass-surface(color-mix(in oklab, var(--btn-glass-accent) 25%, rgb(var(--glass-bg-soft))));
    border: 1px solid color-mix(in oklab, var(--btn-glass-accent) 40%, transparent);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.25);

    /* Hover state: brighter, lifted */
    &:hover {
      background-color: color-mix(in oklab, var(--btn-glass-accent) 35%, rgb(var(--glass-bg-soft)));
      border-color: color-mix(in oklab, var(--btn-glass-accent) 60%, transparent);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.1);
    }

    /* Active state: pressed down */
    &:active {
      @include glass-surface(color-mix(in oklab, var(--btn-glass-accent) 80%, rgb(var(--glass-bg-soft))));
    }
  }
}

@each $name, $color in $theme-colors {
  @include make-btn-glass-variant($name, $color);
}

/* A11y prefs */
@media (prefers-reduced-motion: reduce) {
  .btn-glass { transition: none; }
}
@media (prefers-reduced-transparency: reduce) {
  .btn-glass {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    background: var(--surface-2) !important;
  }
}
